{"AWSTemplateFormatVersion":"2010-09-09","Description":"Ver 4.2 ITNET VPC Setup with options no CSR","Metadata":{"AWS::CloudFormation::Interface":{"ParameterGroups":[{"Label":{"default":"Network Configuration"},"Parameters":["VPCName","VPCCIDR","Tenancy","AvailabilityZones","Environment","QCOMDHCPOptions","DeployNAT","DeployPrivateSubnets","PrivateSubACIDR","PrivateSubBCIDR","PrivateSubCCIDR","DeployPrivateDBSubnets","DBPrivateSubACIDR","DBPrivateSubBCIDR","DBPrivateSubCCIDR","DeployPrivateELBSubnets","ELBPrivateSubACIDR","ELBPrivateSubBCIDR","ELBPrivateSubCCIDR","DeployPublicELBSubnets","PublicSubACIDR","PublicSubBCIDR","PublicSubCCIDR"]},{"Label":{"default":"Instance Options"},"Parameters":["DeployBastionInstance","BastionInstanceType","BastionKeyName","DeployTestInstance","KeyName"]},{"Label":{"default":"SPS ACL Configuration"},"Parameters":["DeploySPSNonProdAcl","DeploySPSNonProdInternalAcl","DeploySPSNonProdIntAndExtAcl","DeploySPSProdAcl","DeploySPSProdInternalAcl","DeploySPSProdIntAndExtAcl"]}],"ParameterLabels":{"DeploySPSNonProdAcl":{"default":"SPS Non Prod External ACL"},"DeploySPSNonProdInternalAcl":{"default":"SPS Non Prod Internal ACL"},"DeploySPSNonProdIntAndExtAcl":{"default":"SPS NonProd Internal & External ACL"},"DeploySPSProdIntAndExtAcl":{"default":"SPS Prod Internal & External ACL"},"DeploySPSProdAcl":{"default":"SPS Prod External ACL"},"DeploySPSProdInternalAcl":{"default":"SPS Prod Internal ACL"},"DeployNAT":{"default":"Deploy an AWS NAT Gateway for the private subnets"},"QCOMDHCPOptions":{"default":"Use Qualnet DNS Servers"},"KeyName":{"default":"Test Instance Key Name"}}}},"Parameters":{"TAGserviceid":{"Type":"String","Default":"netinfra","Description":"A Tag used to identify the service id"},"TAGserviceidQualnetDHCP":{"Type":"String","Default":"netinfra","Description":"A Tag used to identify the service id for Qualnet DHCP options"},"Environment":{"Type":"String","Default":"NON","AllowedValues":["PRD","DEV","TST","STG","NON","STB","TRN","BTA","DMO"],"Description":"Environment type used for service_data Tag"},"Tenancy":{"Type":"String","Default":"default","AllowedValues":["default","dedicated"],"Description":"Tenancy for instances defined in VPC"},"AvailabilityZones":{"Type":"String","Default":"2","AllowedValues":["2","3"],"Description":"Number of AZ's to use"},"DeployPrivateSubnets":{"Type":"String","Default":"Yes","AllowedValues":["Yes","No"],"Description":"Choose Yes to deploy standard private subnets that can be shared among services"},"DeployPrivateDBSubnets":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Choose Yes to deploy dedicated private subnets for Databases"},"DeployPrivateELBSubnets":{"Type":"String","Default":"Yes","AllowedValues":["Yes","No"],"Description":"Choose Yes to deploy dedicated private subnets for Elastic Load Balancer VIPs"},"DeployPublicELBSubnets":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy public ELB subnets if hosting public facing services or for NAT or JumpHost for isolated VPCs"},"DeploySPSNonProdAcl":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy SPS NonProd ACL to ELB subnets to restrict traffic and only allow SPS service"},"DeploySPSNonProdInternalAcl":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy SPS NonProd Internal ACL to ELB subnets to restrict traffic and only allow SPS service"},"DeploySPSNonProdIntAndExtAcl":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy SPS NonProd Internal and External ACL to ELB subnets to restrict traffic and only allow SPS service"},"DeploySPSProdIntAndExtAcl":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy SPS Prod Internal and External ACL to ELB subnets to restrict traffic and only allow SPS service"},"DeploySPSProdAcl":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy SPS Prod ACL to ELB subnets to restrict traffic and only allow SPS service"},"DeploySPSProdInternalAcl":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy SPS Prod ACL to ELB subnets to restrict traffic and only allow SPS service"},"DeployTestInstance":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy a Test Instance in the Private subnet to test connectivity."},"DeployBastionInstance":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy a Bastion Host Instance in the Public subnet for Public VPC's not connected to Qualnet."},"DeployNAT":{"Type":"String","Default":"No","AllowedValues":["Yes","No"],"Description":"Deploy a NAT SG in the Public subnet to provide Internet for Private subnet Instances."},"BastionInstanceType":{"Description":"NAT EC2 instance type","Type":"String","Default":"t2.nano","AllowedValues":["t2.nano","t2.micro"],"ConstraintDescription":"Must be a valid EC2 instance type."},"KeyName":{"Description":"Name of an existing ITNET KeyPair to enable SSH access to the instance","Type":"String","Default":"ITNET-key","ConstraintDescription":"Must be the name of an existing EC2 KeyPair."},"BastionKeyName":{"Description":"Name of an existing KeyPair to enable SSH access to the NAT instance","Type":"String","Default":"ITNET-key","ConstraintDescription":"Must be the name of an existing EC2 KeyPair."},"QCOMDHCPOptions":{"Type":"String","Default":"Yes","AllowedValues":["Yes","No"],"Description":"Use Qualcomm DHCP Profile with Qualnet DNS Servers for the VPC"},"VPCName":{"Type":"String","Default":"CF Test VPC","Description":"Name of the VPC or CSR Tag"},"VPCCIDR":{"Type":"String","Description":"IP Address range for the VPC","MinLength":"9","MaxLength":"18","Default":"10.1.0.0/23","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"PrivateSubACIDR":{"Type":"String","Description":"IP Address range for Private Subnet A","MinLength":"9","MaxLength":"18","Default":"10.1.0.0/25","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"PrivateSubBCIDR":{"Type":"String","Description":"IP Address range for Private Subnet B","MinLength":"9","MaxLength":"18","Default":"10.1.0.128/25","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"PrivateSubCCIDR":{"Type":"String","Description":" IP Address range for Private Subnet C - Only required if using 3 Availability Zones","MinLength":"9","MaxLength":"18","Default":"1.1.1.1/32","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Only required for 3 AZ - Must be a valid IP CIDR range of the form x.x.x.x/x."},"ELBPrivateSubACIDR":{"Type":"String","Description":"IP Address range for Private ELB Subnet A","MinLength":"9","MaxLength":"18","Default":"10.1.1.64/27","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"ELBPrivateSubBCIDR":{"Type":"String","Description":"IP Address range for Private ELB Subnet B","MinLength":"9","MaxLength":"18","Default":"10.1.1.96/27","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"ELBPrivateSubCCIDR":{"Type":"String","Description":" IP Address range for Private ELB Subnet C - Only required if using 3 Availability Zones","MinLength":"9","MaxLength":"18","Default":"1.1.1.1/32","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Only required for 3 AZ - Must be a valid IP CIDR range of the form x.x.x.x/x."},"DBPrivateSubACIDR":{"Type":"String","Description":"IP Address range for Private DB Subnet A","MinLength":"9","MaxLength":"18","Default":"10.1.1.0/27","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"DBPrivateSubBCIDR":{"Type":"String","Description":"IP Address range for Private DB Subnet B","MinLength":"9","MaxLength":"18","Default":"10.1.1.32/27","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"DBPrivateSubCCIDR":{"Type":"String","Description":" IP Address range for Private DB Subnet C - Only required if using 3 Availability Zones","MinLength":"9","MaxLength":"18","Default":"1.1.1.1/32","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Only required for 3 AZ - Must be a valid IP CIDR range of the form x.x.x.x/x."},"PublicSubACIDR":{"Type":"String","Description":"IP Address range for Public ELB Subnet A","MinLength":"9","MaxLength":"18","Default":"10.1.1.128/27","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"PublicSubBCIDR":{"Type":"String","Description":"IP Address range for Public ELB Subnet B","MinLength":"9","MaxLength":"18","Default":"10.1.1.160/27","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."},"PublicSubCCIDR":{"Type":"String","Description":"IP Address range for Public ELB Subnet C - Only required if using 3 Availability Zones","MinLength":"9","MaxLength":"18","Default":"1.1.1.1/32","AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})","ConstraintDescription":"Only required for 3 AZ - Must be a valid IP CIDR range of the form x.x.x.x/x."}},"Conditions":{"CreateNAT":{"Fn::Equals":[{"Ref":"DeployNAT"},"Yes"]},"CreateTestInstance":{"Fn::Equals":[{"Ref":"DeployTestInstance"},"Yes"]},"CreateBastionInstance":{"Fn::Equals":[{"Ref":"DeployBastionInstance"},"Yes"]},"DeployThreeAZ":{"Fn::Equals":[{"Ref":"AvailabilityZones"},"3"]},"DeployTwoAZ":{"Fn::Equals":[{"Ref":"AvailabilityZones"},"2"]},"DeployPrivate":{"Fn::Equals":[{"Ref":"DeployPrivateSubnets"},"Yes"]},"DeployPrivateELB":{"Fn::Equals":[{"Ref":"DeployPrivateELBSubnets"},"Yes"]},"DeployPrivateDB":{"Fn::Equals":[{"Ref":"DeployPrivateDBSubnets"},"Yes"]},"DeployPublicELB":{"Fn::Equals":[{"Ref":"DeployPublicELBSubnets"},"Yes"]},"DeploySPSNonProdAccessList":{"Fn::Equals":[{"Ref":"DeploySPSNonProdAcl"},"Yes"]},"DeploySPSNonProdInternalAccessList":{"Fn::Equals":[{"Ref":"DeploySPSNonProdInternalAcl"},"Yes"]},"DeploySPSNonProdInternalandExternalAcl":{"Fn::Equals":[{"Ref":"DeploySPSNonProdIntAndExtAcl"},"Yes"]},"DeploySPSProdInternalandExternalAcl":{"Fn::Equals":[{"Ref":"DeploySPSProdIntAndExtAcl"},"Yes"]},"DeploySPSProdAccessList":{"Fn::Equals":[{"Ref":"DeploySPSProdAcl"},"Yes"]},"DeploySPSProdInternalAccessList":{"Fn::Equals":[{"Ref":"DeploySPSProdInternalAcl"},"Yes"]},"QualnetDHCP":{"Fn::Equals":[{"Ref":"QCOMDHCPOptions"},"Yes"]},"DeployThreeAZandPrivateSubnets":{"Fn::And":[{"Condition":"DeployThreeAZ"},{"Condition":"DeployPrivate"}]},"DeployThreeAZandPrivateELBSubnets":{"Fn::And":[{"Condition":"DeployThreeAZ"},{"Condition":"DeployPrivateELB"}]},"DeployThreeAZandPrivateDBSubnets":{"Fn::And":[{"Condition":"DeployThreeAZ"},{"Condition":"DeployPrivateDB"}]},"DeployThreeAZandPublicSubnets":{"Fn::And":[{"Condition":"DeployThreeAZ"},{"Condition":"DeployPublicELB"}]},"DeployPublicBastion":{"Fn::And":[{"Condition":"CreateBastionInstance"},{"Condition":"DeployPublicELB"}]}},"Mappings":{"Region2CSR":{"ap-northeast-1":{"RN":"Tokyo","EC2":"ami-59bdb937"},"ap-south-1":{"RN":"Mumbai","EC2":"ami-0aac2e5b150a37380"},"ap-southeast-1":{"RN":"Singapore","EC2":"ami-0103cd62"},"ap-southeast-2":{"RN":"Sydney","EC2":"ami-11032472"},"cn-north-1":{"RN":"Beijing","EC2":"ami-053617c9d818c1189"},"cn-northwest-1":{"RN":"Ningxia","EC2":"ami-094b7433620966eb5"},"eu-west-1":{"RN":"Ireland","EC2":"ami-0d693c2c90bdf5691"},"eu-central-1":{"RN":"Frankfurt","EC2":"ami-a6b0b7bb"},"sa-east-1":{"RN":"Sao Paulo","EC2":"ami-f0f4779c"},"us-east-1":{"RN":"N. Virginia","EC2":"ami-0213d971c49f735a4"},"us-east-2":{"RN":"Ohio","EC2":"ami-0f18a55cc33560c42"},"us-west-1":{"RN":"N. California","EC2":"ami-d1f482b1a"},"us-west-2":{"RN":"Oregon","EC2":"ami-09a1844dda27f5870"}}},"Resources":{"qcomDHCPoptions":{"Type":"AWS::EC2::DHCPOptions","Condition":"QualnetDHCP","Properties":{"DomainName":"qualcomm.com","DomainNameServers":["129.46.132.28","129.46.50.7"],"NtpServers":["10.43.128.5"],"Tags":[{"Key":"Name","Value":{"Fn::Join":["",[{"Ref":"VPCName"}," QCOM DHCP"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceidQualnetDHCP"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource"]]}}]}},"VPC":{"Type":"AWS::EC2::VPC","Properties":{"EnableDnsSupport":"true","EnableDnsHostnames":"true","InstanceTenancy":{"Ref":"Tenancy"},"CidrBlock":{"Ref":"VPCCIDR"},"Tags":[{"Key":"Name","Value":{"Ref":"VPCName"}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource"]]}}]}},"VPCDHCPOptionsAssociation":{"Type":"AWS::EC2::VPCDHCPOptionsAssociation","Condition":"QualnetDHCP","Properties":{"VpcId":{"Ref":"VPC"},"DhcpOptionsId":{"Ref":"qcomDHCPoptions"}}},"PrivateSubnetA":{"Type":"AWS::EC2::Subnet","Condition":"DeployPrivate","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"PrivateSubACIDR"},"AvailabilityZone":{"Fn::Select":["0",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Private A"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateSubnetB":{"Type":"AWS::EC2::Subnet","Condition":"DeployPrivate","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"PrivateSubBCIDR"},"AvailabilityZone":{"Fn::Select":["1",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Private B"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Fn::Join":["",["ITNET resource for ",{"Ref":"VPCName"}]]}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateSubnetC":{"Type":"AWS::EC2::Subnet","Condition":"DeployThreeAZandPrivateSubnets","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"PrivateSubCCIDR"},"AvailabilityZone":{"Fn::Select":["2",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Private C"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateELBSubnetA":{"Type":"AWS::EC2::Subnet","Condition":"DeployPrivateELB","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"ELBPrivateSubACIDR"},"AvailabilityZone":{"Fn::Select":["0",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"PrivateELB A"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateELBSubnetB":{"Type":"AWS::EC2::Subnet","Condition":"DeployPrivateELB","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"ELBPrivateSubBCIDR"},"AvailabilityZone":{"Fn::Select":["1",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"PrivateELB B"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateELBSubnetC":{"Type":"AWS::EC2::Subnet","Condition":"DeployThreeAZandPrivateELBSubnets","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"ELBPrivateSubCCIDR"},"AvailabilityZone":{"Fn::Select":["2",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"PrivateELB C"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateDBSubnetA":{"Type":"AWS::EC2::Subnet","Condition":"DeployPrivateDB","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"DBPrivateSubACIDR"},"AvailabilityZone":{"Fn::Select":["0",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"PrivateDB A"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateDBSubnetB":{"Type":"AWS::EC2::Subnet","Condition":"DeployPrivateDB","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"DBPrivateSubBCIDR"},"AvailabilityZone":{"Fn::Select":["1",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"PrivateDB B"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateDBSubnetC":{"Type":"AWS::EC2::Subnet","Condition":"DeployThreeAZandPrivateDBSubnets","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"DBPrivateSubCCIDR"},"AvailabilityZone":{"Fn::Select":["2",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"PrivateDB C"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateRouteTable":{"Type":"AWS::EC2::RouteTable","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Private RT"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"PrivateSubnetRouteTableAssociationA":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Properties":{"SubnetId":{"Ref":"PrivateSubnetA"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateSubnetRouteTableAssociationB":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Properties":{"SubnetId":{"Ref":"PrivateSubnetB"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateSubnetRouteTableAssociationC":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Condition":"DeployThreeAZ","Properties":{"SubnetId":{"Ref":"PrivateSubnetC"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateELBSubnetRouteTableAssociationA":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PrivateELBSubnetA","PrivateRouteTable"],"Condition":"DeployPrivateELB","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetA"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateELBSubnetRouteTableAssociationB":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PrivateELBSubnetB","PrivateRouteTable"],"Condition":"DeployPrivateELB","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetB"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateELBSubnetRouteTableAssociationC":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PrivateELBSubnetC","PrivateRouteTable"],"Condition":"DeployThreeAZandPrivateELBSubnets","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetC"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateDBSubnetRouteTableAssociationA":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PrivateDBSubnetA","PrivateRouteTable"],"Condition":"DeployPrivateDB","Properties":{"SubnetId":{"Ref":"PrivateDBSubnetA"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateDBSubnetRouteTableAssociationB":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PrivateDBSubnetB","PrivateRouteTable"],"Condition":"DeployPrivateDB","Properties":{"SubnetId":{"Ref":"PrivateDBSubnetB"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PrivateDBSubnetRouteTableAssociationC":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PrivateDBSubnetC","PrivateRouteTable"],"Condition":"DeployThreeAZandPrivateDBSubnets","Properties":{"SubnetId":{"Ref":"PrivateDBSubnetC"},"RouteTableId":{"Ref":"PrivateRouteTable"}}},"PublicSubnetA":{"Type":"AWS::EC2::Subnet","Condition":"DeployPublicELB","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"PublicSubACIDR"},"AvailabilityZone":{"Fn::Select":["0",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Public A"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Public"]]}}]}},"PublicSubnetB":{"Type":"AWS::EC2::Subnet","Condition":"DeployPublicELB","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"PublicSubBCIDR"},"AvailabilityZone":{"Fn::Select":["1",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Public B"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Public"]]}}]}},"PublicSubnetC":{"Type":"AWS::EC2::Subnet","Condition":"DeployThreeAZandPublicSubnets","Properties":{"VpcId":{"Ref":"VPC"},"CidrBlock":{"Ref":"PublicSubCCIDR"},"AvailabilityZone":{"Fn::Select":["2",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Public C"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Public"]]}}]}},"PublicRouteTable":{"Type":"AWS::EC2::RouteTable","Condition":"DeployPublicELB","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Public RT"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Public"]]}}]}},"PublicSubnetRouteTableAssociationA":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PublicSubnetA","PublicRouteTable"],"Condition":"DeployPublicELB","Properties":{"SubnetId":{"Ref":"PublicSubnetA"},"RouteTableId":{"Ref":"PublicRouteTable"}}},"PublicSubnetRouteTableAssociationB":{"Type":"AWS::EC2::SubnetRouteTableAssociation","DependsOn":["PublicSubnetB","PublicRouteTable"],"Condition":"DeployPublicELB","Properties":{"SubnetId":{"Ref":"PublicSubnetB"},"RouteTableId":{"Ref":"PublicRouteTable"}}},"PublicSubnetRouteTableAssociationC":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Condition":"DeployThreeAZandPublicSubnets","DependsOn":["PublicSubnetC","PublicRouteTable"],"Properties":{"SubnetId":{"Ref":"PublicSubnetC"},"RouteTableId":{"Ref":"PublicRouteTable"}}},"InternetGateway":{"Type":"AWS::EC2::InternetGateway","Condition":"DeployPublicELB","Properties":{"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"IGW"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource"]]}}]}},"GatewayToInternet":{"Type":"AWS::EC2::VPCGatewayAttachment","Condition":"DeployPublicELB","Properties":{"VpcId":{"Ref":"VPC"},"InternetGatewayId":{"Ref":"InternetGateway"}}},"NATGateway":{"Type":"AWS::EC2::NatGateway","DependsOn":"GatewayToInternet","Condition":"CreateNAT","Properties":{"AllocationId":{"Fn::GetAtt":["EIPNAT","AllocationId"]},"SubnetId":{"Ref":"PublicSubnetA"}}},"PublicRoute":{"Type":"AWS::EC2::Route","DependsOn":"GatewayToInternet","Condition":"DeployPublicELB","Properties":{"RouteTableId":{"Ref":"PublicRouteTable"},"DestinationCidrBlock":"0.0.0.0/0","GatewayId":{"Ref":"InternetGateway"}}},"NATRoute":{"Type":"AWS::EC2::Route","Condition":"CreateNAT","DependsOn":"NATGateway","Properties":{"RouteTableId":{"Ref":"PrivateRouteTable"},"DestinationCidrBlock":"0.0.0.0/0","NatGatewayId":{"Ref":"NATGateway"}}},"S3Endpoint":{"Type":"AWS::EC2::VPCEndpoint","Properties":{"PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":"*","Effect":"Allow","Resource":"*","Principal":"*"}]},"RouteTableIds":{"Fn::If":["DeployPublicELB",[{"Ref":"PrivateRouteTable"},{"Ref":"PublicRouteTable"}],[{"Ref":"PrivateRouteTable"}]]},"ServiceName":{"Fn::Join":["",["com.amazonaws.",{"Ref":"AWS::Region"},".s3"]]},"VpcId":{"Ref":"VPC"}}},"SPSNonProdAcl":{"Condition":"DeploySPSNonProdAccessList","Type":"AWS::EC2::NetworkAcl","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"SPS NonProd ACL"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"SPSNonProdNetworkAclEntryInbound1":{"Condition":"DeploySPSNonProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdAcl"},"RuleNumber":"100","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.82.0/24","PortRange":{"From":"80","To":"80"}}},"SPSNonProdNetworkAclEntryInbound2":{"Condition":"DeploySPSNonProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdAcl"},"RuleNumber":"110","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.82.0/24","PortRange":{"From":"443","To":"443"}}},"SPSNonProdNetworkAclEntryInbound3":{"Condition":"DeploySPSNonProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdAcl"},"RuleNumber":"150","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":{"Ref":"VPCCIDR"},"PortRange":{"From":"0","To":"65535"}}},"SPSNonProdNetworkAclEntryOutbound1":{"Condition":"DeploySPSNonProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdAcl"},"RuleNumber":"100","Protocol":"-1","RuleAction":"allow","Egress":"true","CidrBlock":"0.0.0.0/0"}},"SPSNonProdNetworkAclAssociationPrivateA":{"DependsOn":"SPSNonProdAcl","Condition":"DeploySPSNonProdAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetA"},"NetworkAclId":{"Ref":"SPSNonProdAcl"}}},"SPSNonProdNetworkAclAssociationPrivateB":{"DependsOn":"SPSNonProdAcl","Condition":"DeploySPSNonProdAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetB"},"NetworkAclId":{"Ref":"SPSNonProdAcl"}}},"SPSNonProdInternalAcl":{"Condition":"DeploySPSNonProdInternalAccessList","Type":"AWS::EC2::NetworkAcl","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"SPS NonProd Internal ACL"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"SPSNonProdInternalNetworkAclEntryInbound1":{"Condition":"DeploySPSNonProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdInternalAcl"},"RuleNumber":"100","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.228.0/23","PortRange":{"From":"80","To":"80"}}},"SPSNonProdInternalNetworkAclEntryInbound2":{"Condition":"DeploySPSNonProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdInternalAcl"},"RuleNumber":"110","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.228.0/23","PortRange":{"From":"443","To":"443"}}},"SPSNonProdInternalNetworkAclEntryInbound3":{"Condition":"DeploySPSNonProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdInternalAcl"},"RuleNumber":"120","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":{"Ref":"VPCCIDR"},"PortRange":{"From":"0","To":"65535"}}},"SPSNonProdInternalNetworkAclEntryOutbound1":{"Condition":"DeploySPSNonProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdInternalAcl"},"RuleNumber":"100","Protocol":"-1","RuleAction":"allow","Egress":"true","CidrBlock":"0.0.0.0/0"}},"SPSNonProdInternalNetworkAclAssociationPrivateA":{"DependsOn":"SPSNonProdInternalAcl","Condition":"DeploySPSNonProdInternalAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetA"},"NetworkAclId":{"Ref":"SPSNonProdInternalAcl"}}},"SPSNonProdInternalNetworkAclAssociationPrivateB":{"DependsOn":"SPSNonProdInternalAcl","Condition":"DeploySPSNonProdInternalAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetB"},"NetworkAclId":{"Ref":"SPSNonProdInternalAcl"}}},"SPSNonProdIntAndExtAcl":{"Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAcl","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"SPS NonProd Internal and External ACL"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"SPSNonProdIntAndExtNetworkAclEntryInbound1":{"Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"},"RuleNumber":"100","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.228.0/23","PortRange":{"From":"80","To":"80"}}},"SPSNonProdIntAndExtNetworkAclEntryInbound2":{"Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"},"RuleNumber":"110","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.228.0/23","PortRange":{"From":"443","To":"443"}}},"SPSNonProdIntAndExtNetworkAclEntryInbound3":{"Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"},"RuleNumber":"120","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.82.0/24","PortRange":{"From":"80","To":"80"}}},"SPSNonProdIntAndExtNetworkAclEntryInbound4":{"Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"},"RuleNumber":"130","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.82.0/24","PortRange":{"From":"443","To":"443"}}},"SPSNonProdIntAndExtNetworkAclEntryInbound5":{"Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"},"RuleNumber":"150","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":{"Ref":"VPCCIDR"},"PortRange":{"From":"0","To":"65535"}}},"SPSNonProdIntAndExtNetworkAclEntryOutbound1":{"Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"},"RuleNumber":"100","Protocol":"-1","RuleAction":"allow","Egress":"true","CidrBlock":"0.0.0.0/0"}},"SPSNonProdIntAndExtNetworkAclAssociationPrivateA":{"DependsOn":"SPSNonProdIntAndExtAcl","Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetA"},"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"}}},"SPSNonProdIntAndExtNetworkAclAssociationPrivateB":{"DependsOn":"SPSNonProdIntAndExtAcl","Condition":"DeploySPSNonProdInternalandExternalAcl","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetB"},"NetworkAclId":{"Ref":"SPSNonProdIntAndExtAcl"}}},"SPSProdIntAndExtAcl":{"Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAcl","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"SPS Prod Internal and External ACL"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"SPSProdIntAndExtNetworkAclEntryInbound1":{"Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"},"RuleNumber":"100","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.104.0/21","PortRange":{"From":"80","To":"80"}}},"SPSProdIntAndExtNetworkAclEntryInbound2":{"Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"},"RuleNumber":"110","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.104.0/21","PortRange":{"From":"443","To":"443"}}},"SPSProdIntAndExtNetworkAclEntryInbound3":{"Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"},"RuleNumber":"120","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.94.0/23","PortRange":{"From":"80","To":"80"}}},"SPSProdIntAndExtNetworkAclEntryInbound4":{"Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"},"RuleNumber":"130","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.94.0/23","PortRange":{"From":"443","To":"443"}}},"SPSProdIntAndExtNetworkAclEntryInbound5":{"Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"},"RuleNumber":"150","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":{"Ref":"VPCCIDR"},"PortRange":{"From":"0","To":"65535"}}},"SPSProdIntAndExtNetworkAclEntryOutbound1":{"Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"},"RuleNumber":"100","Protocol":"-1","RuleAction":"allow","Egress":"true","CidrBlock":"0.0.0.0/0"}},"SPSProdIntAndExtNetworkAclAssociationPrivateA":{"DependsOn":"SPSProdIntAndExtAcl","Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetA"},"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"}}},"SPSProdIntAndExtNetworkAclAssociationPrivateB":{"DependsOn":"SPSProdIntAndExtAcl","Condition":"DeploySPSProdInternalandExternalAcl","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetB"},"NetworkAclId":{"Ref":"SPSProdIntAndExtAcl"}}},"SPSProdAcl":{"Condition":"DeploySPSProdAccessList","Type":"AWS::EC2::NetworkAcl","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"SPS Prod ACL"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"SPSProdNetworkAclEntryInbound1":{"Condition":"DeploySPSProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdAcl"},"RuleNumber":"100","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.94.0/24","PortRange":{"From":"80","To":"80"}}},"SPSProdNetworkAclEntryInbound2":{"Condition":"DeploySPSProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdAcl"},"RuleNumber":"110","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.94.0/24","PortRange":{"From":"443","To":"443"}}},"SPSProdNetworkAclEntryInbound3":{"Condition":"DeploySPSProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdAcl"},"RuleNumber":"120","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":{"Ref":"VPCCIDR"},"PortRange":{"From":"0","To":"65535"}}},"SPSProdNetworkAclEntryOutbound1":{"Condition":"DeploySPSProdAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdAcl"},"RuleNumber":"100","Protocol":"-1","RuleAction":"allow","Egress":"true","CidrBlock":"0.0.0.0/0"}},"SPSProdNetworkAclAssociationPrivateA":{"DependsOn":"SPSProdAcl","Condition":"DeploySPSProdAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetA"},"NetworkAclId":{"Ref":"SPSProdAcl"}}},"SPSProdNetworkAclAssociationPrivateB":{"DependsOn":"SPSProdAcl","Condition":"DeploySPSProdAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetB"},"NetworkAclId":{"Ref":"SPSProdAcl"}}},"SPSProdInternalAcl":{"Condition":"DeploySPSProdInternalAccessList","Type":"AWS::EC2::NetworkAcl","Properties":{"VpcId":{"Ref":"VPC"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"SPS Prod Internal ACL"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource+Network=Private"]]}}]}},"SPSProdInternalNetworkAclEntryInbound1":{"Condition":"DeploySPSProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdInternalAcl"},"RuleNumber":"100","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.104.0/21","PortRange":{"From":"80","To":"80"}}},"SPSProdInternalNetworkAclEntryInbound2":{"Condition":"DeploySPSProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdInternalAcl"},"RuleNumber":"110","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":"10.101.104.0/21","PortRange":{"From":"443","To":"443"}}},"SPSProdInternalNetworkAclEntryInbound3":{"Condition":"DeploySPSProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdInternalAcl"},"RuleNumber":"120","Protocol":"6","RuleAction":"allow","Egress":"false","CidrBlock":{"Ref":"VPCCIDR"},"PortRange":{"From":"0","To":"65535"}}},"SPSProdInternalNetworkAclEntryOutbound1":{"Condition":"DeploySPSProdInternalAccessList","Type":"AWS::EC2::NetworkAclEntry","Properties":{"NetworkAclId":{"Ref":"SPSProdInternalAcl"},"RuleNumber":"100","Protocol":"-1","RuleAction":"allow","Egress":"true","CidrBlock":"0.0.0.0/0"}},"SPSProdInternalNetworkAclAssociationPrivateA":{"DependsOn":"SPSProdInternalAcl","Condition":"DeploySPSProdInternalAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetA"},"NetworkAclId":{"Ref":"SPSProdInternalAcl"}}},"SPSProdInternalNetworkAclAssociationPrivateB":{"DependsOn":"SPSProdInternalAcl","Condition":"DeploySPSProdInternalAccessList","Type":"AWS::EC2::SubnetNetworkAclAssociation","Properties":{"SubnetId":{"Ref":"PrivateELBSubnetB"},"NetworkAclId":{"Ref":"SPSProdInternalAcl"}}},"TestInstanceSG":{"Type":"AWS::EC2::SecurityGroup","Condition":"CreateTestInstance","Properties":{"GroupDescription":"TestInstanceSG","VpcId":{"Ref":"VPC"},"SecurityGroupIngress":{"IpProtocol":"-1","FromPort":"-1","ToPort":"-1","CidrIp":"10.0.0.0/8"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Test EC2 Private"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource"]]}}]}},"BastionInstanceSG":{"Type":"AWS::EC2::SecurityGroup","Condition":"DeployPublicBastion","Properties":{"GroupDescription":"NAT SG","VpcId":{"Ref":"VPC"},"SecurityGroupIngress":[{"IpProtocol":"tcp","FromPort":"22","ToPort":"22","CidrIp":"192.35.156.0/24"},{"IpProtocol":"tcp","FromPort":"22","ToPort":"22","CidrIp":"199.106.96.0/19"},{"IpProtocol":"tcp","FromPort":"22","ToPort":"22","CidrIp":"129.46.0.0/16"}],"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Bastian Host SG"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource"]]}}]}},"EIPNAT":{"Type":"AWS::EC2::EIP","Condition":"CreateNAT","Properties":{"Domain":"vpc"}},"EIPBastion":{"Type":"AWS::EC2::EIP","Condition":"DeployPublicBastion","Properties":{"Domain":"vpc"}},"EIPBastionAssoc":{"Type":"AWS::EC2::EIPAssociation","DependsOn":"BastionInstance","Condition":"DeployPublicBastion","Properties":{"AllocationId":{"Fn::GetAtt":["EIPBastion","AllocationId"]},"InstanceId":{"Ref":"BastionInstance"}}},"TestInstance":{"Type":"AWS::EC2::Instance","Condition":"CreateTestInstance","Properties":{"AvailabilityZone":{"Fn::Select":["0",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"ImageId":{"Fn::FindInMap":["Region2CSR",{"Ref":"AWS::Region"},"EC2"]},"SecurityGroupIds":[{"Ref":"TestInstanceSG"}],"SubnetId":{"Ref":"PrivateSubnetA"},"InstanceType":"t2.nano","KeyName":{"Ref":"KeyName"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Test EC2"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource"]]}}]}},"BastionInstance":{"Type":"AWS::EC2::Instance","Condition":"DeployPublicBastion","Properties":{"AvailabilityZone":{"Fn::Select":["0",{"Fn::GetAZs":{"Ref":"AWS::Region"}}]},"ImageId":{"Fn::FindInMap":["Region2CSR",{"Ref":"AWS::Region"},"EC2"]},"SecurityGroupIds":[{"Ref":"BastionInstanceSG"}],"SubnetId":{"Ref":"PublicSubnetA"},"SourceDestCheck":"false","InstanceType":{"Ref":"BastionInstanceType"},"KeyName":{"Ref":"BastionKeyName"},"Tags":[{"Key":"Name","Value":{"Fn::Join":[" ",[{"Ref":"VPCName"},"Bastion Host"]]}},{"Key":"admin_contact","Value":"itnet.aws"},{"Key":"service_id","Value":{"Ref":"TAGserviceid"}},{"Key":"service_data","Value":{"Fn::Join":["",["env=",{"Ref":"Environment"},"+createby=ITNET+Createdby=ITNETCloudFormation+Purpose=ITNETVPCResource"]]}}]}}},"Outputs":{"VPCName":{"Description":"VPC Name","Value":{"Ref":"VPCName"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-VPCName"}}},"VPCCIDR":{"Value":{"Ref":"VPCCIDR"},"Description":"VPC CIDR","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-VPCCIDR"}}},"VPCID":{"Value":{"Ref":"VPC"},"Description":"VPC CIDR","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-VPCID"}}},"TestInstanceIP":{"Condition":"CreateTestInstance","Value":{"Fn::GetAtt":["TestInstance","PrivateIp"]},"Description":"Private IP of Test Instance","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-TestInstanceIP"}}},"BastionEIP":{"Condition":"DeployPublicBastion","Value":{"Ref":"EIPBastion"},"Description":"Public Elastic IP of Bastion Instance","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-BastionEIP"}}},"PrivateSubnetA":{"Condition":"DeployPrivate","Value":{"Ref":"PrivateSubnetA"},"Description":"PrivateSubnetA ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateSubnetA"}}},"PrivateSubnetB":{"Condition":"DeployPrivate","Value":{"Ref":"PrivateSubnetB"},"Description":"PrivateSubnetB ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateSubnetB"}}},"PrivateSubnetC":{"Condition":"DeployThreeAZandPrivateSubnets","Value":{"Ref":"PrivateSubnetC"},"Description":"PrivateSubnetC ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateSubnetC"}}},"PrivateELBSubnetA":{"Condition":"DeployPrivateELB","Value":{"Ref":"PrivateELBSubnetA"},"Description":"PrivateELBSubnetA ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateELBSubnetA"}}},"PrivateELBSubnetB":{"Condition":"DeployPrivateELB","Value":{"Ref":"PrivateELBSubnetB"},"Description":"PrivateELBSubnetB ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateELBSubnetB"}}},"PrivateELBSubnetC":{"Condition":"DeployThreeAZandPrivateELBSubnets","Value":{"Ref":"PrivateELBSubnetC"},"Description":"PrivateELBSubnetC ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateELBSubnetC"}}},"PrivateDBSubnetA":{"Condition":"DeployPrivateDB","Value":{"Ref":"PrivateDBSubnetA"},"Description":"PrivateDBSubnetA ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateDBSubnetA"}}},"PrivateDBSubnetB":{"Condition":"DeployPrivateDB","Value":{"Ref":"PrivateDBSubnetB"},"Description":"PrivateDBSubnetB ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateDBSubnetB"}}},"PrivateDBSubnetC":{"Condition":"DeployThreeAZandPrivateDBSubnets","Value":{"Ref":"PrivateDBSubnetC"},"Description":"PrivateDBSubnetC ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PrivateDBSubnetC"}}},"PublicSubnetA":{"Condition":"DeployPublicELB","Value":{"Ref":"PublicSubnetA"},"Description":"PublicSubnetA ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PublicSubnetA"}}},"PublicSubnetB":{"Condition":"DeployPublicELB","Value":{"Ref":"PublicSubnetB"},"Description":"PublicSubnetB ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PublicSubnetB"}}},"PublicSubnetC":{"Condition":"DeployThreeAZandPublicSubnets","Value":{"Ref":"PublicSubnetC"},"Description":"PublicSubnetC ID","Export":{"Name":{"Fn::Sub":"${AWS::StackName}-PublicSubnetC"}}}}}
